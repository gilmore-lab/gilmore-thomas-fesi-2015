---
title: "gilmore-thomas-fesi-2015-figs-only.Rmd"
author: "rogilmore"
date: "`r Sys.time()`"
output: html_document
params:
  group: child
  harmonic: 1F1
  p_thresh: .0005
  dpi: 72
  plot_dev: png
  n_top: 9
  plot_titles: TRUE
---

## Analysis of `r params$group` group results at `r params$harmonic`

### Initialize

```{r set-up-paths}
data_path <- 'csv/'
figs_path <- 'figs/'
R_path <- 'R/'

moco_fn <- paste("moco-3-pattern-", params$group, ".csv", sep="")
egi_fn <- "egi.csv"

moco_path <- paste(data_path, moco_fn, sep="")
egi_path <- paste(data_path, egi_fn, sep="")
topoplot_fullpath <- paste(figs_path, "topoplot.png", sep="")
```

```{r source-R-scripts, warning=FALSE, message=FALSE}
# Source R scripts.
file.sources <- list.files(path="R", pattern="*.R$", full.names = TRUE)
sapply(file.sources, source, .GlobalEnv)
```

```{r libraries, warning=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
library(png)
library(gridExtra)
library(tidyr)
library(knitr)
library(DescTools)
library(heplots) # for etasq()
library(ez)
library(Cairo)

path2figs <- paste('figs', params$harmonic, params$group, "", sep="/")
knitr::opts_chunk$set(dpi=params$dpi, dev=params$plot_dev, fig.path=path2figs, fig.width = 8.5)
```

### Load dataframes

```{r load-data}
df_moco <- read.csv(moco_path)
df_egi <- read.csv(egi_path)
```

### Compute and plot channel-wise effects for `r params$harmonic` for `r init_cap(params$group)` participants.

#### Effects for pattern and speed

```{r figX-channel-wise-effects}
form <- cbind(Sr, Si) ~ Pattern*Speed + Error(iSess)
chan_eff <- compute_chan_effects(df_moco, params$harmonic, form)
df_chan_stats <- make_stats_df(chan_eff, df_egi)
plot_channel_effects(df_chan_stats, harm=params$harmonic, group=params$group, topoplot_fullpath, plot_titles=params$plot_titles)
```

### Mean amplitude plots of `r params$harmonic` channels meeting `r paste('p< ', params$p_thresh, sep='')` for `r init_cap(params$group)` participants.

```{r figX-vector-amplitude-barplots-pattern}
plot_channel_magnitudes(df_chan_stats, df_moco, params$group, params$harmonic, "Pattern", as.numeric(params$p_thresh), plot_titles=params$plot_titles)
```

```{r figX-vector-amplitude-barplots-speed}
plot_channel_magnitudes(df_chan_stats, df_moco, params$group, params$harmonic, "Speed", as.numeric(params$p_thresh), plot_titles=params$plot_titles)
```

```{r figX-vector-amplitude-barplots-pattbyspd}
plot_channel_magnitudes(df_chan_stats, df_moco, params$group, params$harmonic, "Patt*Spd", as.numeric(params$p_thresh), plot_titles=params$plot_titles)
```

### Complex Domain Plots for `r params$n_top` channels with highest amplitudes for `r params$harmonic` in `r init_cap(params$group)` participants

```{r figX-complex-domain-plots-pattern}
plot_complex_domain_results(df_chan_stats, df_moco, "Pattern", params$group, params$harmonic, as.numeric(params$n_top), as.numeric(params$p_thresh), plot_titles=params$plot_titles)
```

```{r figX-complex-domain-plots-speed}
plot_complex_domain_results(df_chan_stats, df_moco, "Speed", params$group, params$harmonic, as.numeric(params$n_top), as.numeric(params$p_thresh), plot_titles=params$plot_titles)
```

```{r figX-complex-domain-plots-pattern-pattbyspd}
plot_complex_domain_results(df_chan_stats, df_moco, "Patt*Spd", params$group, params$harmonic, as.numeric(params$n_top), as.numeric(params$p_thresh), plot_titles=params$plot_titles)
```
